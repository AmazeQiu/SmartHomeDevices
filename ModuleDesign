智能家居漏洞平台设计思路
修订记录
日期	操作	操作者	详情
2021.10.25	创建	张泽馨	文档创建

1.	简述
智能家居漏洞平台是一个对局域网内智能家居设备漏洞进行利用和复现展示的，软硬件协同的平台。
智能家居漏洞平台中，硬件平台为软件系统的实际控制对象和实物模型演示，软件平台为硬件平台的控制源和漏洞利用的用户界面展示。
硬件平台应以参照常见智慧家庭进行模型搭建，包括局域网网关、智能开关、摄像头、智能台灯等常见IoT设备，各IoT设备连接在同一局域网内，设备的拥有者将控制设备连接在同一局域网内即可进行控制（如：米家APP）。软件平台应具有漏洞利用，设备控制以及用户界面展示的效果，用户可以在软件平台上实现局域网入侵，设备搜寻、设备控制等攻击行为，并具有良好的用户界面使得操作和数据可视化。
智能家居漏洞平台应具有模块化、易扩展的特点，做到设备漏洞利用的模块化，漏洞利用场景实现的模块化，攻击步骤的模块化，以及对日后可能存在漏洞的设备进行研究分析和复现利用后可以快速简便地在软硬件平台上进行部署。
智能家居漏洞平台除了提供IoT设备的漏洞研究与利用之外，还可以用作对一个封闭环境进行渗透测试、网络安全攻击实践、攻击场景设计的实验平台。
2.	漏洞复现场景设计
场景一：局域网入侵-控制场景。通过社工方式/密码破解/Wifi万能钥匙等方式接入局域网，或是通过其他入侵局域网，搜索当前局域网下的设备，获取相应IoT设备ip及token，进行设备控制。（暂时实现有困难，需要后续研究）
场景二：房主-租户场景（目前可实现）租户租住房主提供的房间，在租期内，房主将自己连接的米家设备共享给租户，租户在此期间可以获取到设备的token。租期满后房主收回权限，此时租户可利用原有token在局域网下继续控制设备。
场景n：……
3.	漏洞复现原理
目前针对Mi设备的漏洞复现原理为：与Mi设备连接在同一局域网内，通过miio.api获取Mi设备token值，利用此token值进行设备控制。（或是通过低版本米家App数据库文件获取token值，再利用token进行设备控制）
后续其他设备的漏洞复现，及miio设备的其他控制方式，包括协议中的漏洞、App中的漏洞、认证中的漏洞等，可以进行深入研究。
4.	系统整体设计 
见思路设计图 
5.	具体模块设计
网络渗透模块：实现对局域网的入侵。根据攻击目标划分为两个子模块，一是获取当前局域网的密钥实现连接，可查阅论文、国内外技术博客进行尝试，也可简单通过社工方式获取，实际应用中只要能够达到目标即可。二是入侵局域网后，考虑对网关设备进行进一步控制，可以尝试密码爆破以及其他Web攻击方式，试图进一步获取对局域网的控制权。
设备控制模块：实现对IoT设备的控制。根据IoT设备是否为Mi设备划分两个模块。对于Mi设备利用python-miio对其进行token获取（或是与安卓虚拟机米家App数据库进行数据交互获取token），然后用miio.api对其进行控制。对于非Mi设备，后续考虑对其控制端App、通信流程和通信协议、数据库等进行分析后，决定是否添加。
漏洞演示模块： PC端（作为入侵者）实现对设备的控制。设备控制模块获取到设备的控制权限后，将设备的类型和控制端口传递给漏洞展示模块，该模块根据设备类型确定对设备的操作方式以及对设备数据的处理方式。
